= Migration with the Mule Migration Tool

//TODO: FOR GA, REMOVE *Beta* FROM GA VERSION
*Beta Release: Mule Migration tool and Compatibility Module*

[[migration_tool]]
== Mule Migration Tool

The Mule Migration tool (migrator) automates the migration of Mule 3
apps to Mule 4. Though it does not migrate the app entirely,
the tool provides significant help with these tasks:

* Migrating the project structure.
* Automatically creating descriptor files, such as `pom.xml` or `mule-artifact.json`.
* Automatically performing a great number of adaptations in the app's
code.
* Providing guidance on how to manually migrate components and patterns that
cannot be migrated automatically.

The migrator helps with such heavy lifting, but it is not to be expected to
deliver a fully functional app. Some additional steps are required.
Those steps include testing and can also include:

* Manual migration of unsupported components.
* Manual migration of complex DataWeave transformations.
* Prior migration of the DataMapper with the _DataWeave_ Migration tool,
_before_ running the Mule Migration tool.

It is important to note that the Mule Migration tool does not support
incremental migrations.

[[compatibility_module]]
== Compatibility Module

Some components or patterns cannot be migrated automatically by transforming
the app's XML. For such cases, the migrator adds the Compatibility
module to your project. The Compatibility module is a set of components that
either adapts Mule 3 components into the Mule 4 architecture, or in some cases,
enables some Mule 3 components to work in Mule 4.

*Important:* MuleSoft recommends that you migrate to a point where the
Compatibility module can be dropped from your app and that you simply use the
module as a bridge until the manual steps of the migration are complete.

The Compatibility module does not cover every migration gap. Instead, it
complements the Mule Migration tool:

 * By providing MEL support for the cases where a MEL expression could not be
 migrated to DataWeave automatically.
 * By adapting the Mule 3 Message model to Mule 4.

You or your team will need to handle other migration gaps that are covered in
the <<migration_report, Migration report>>.

//TODO: QUESTION: API for the tool? Tool consists of an execution engine,
//a proprietary API to allow extensions of it, and a reporting framework.

[[migration_overview]]
== The Migration Process

The migration process is a multi-part procedure, where you:

. Perform any pre-migration steps, such as migrating from the DataMapper to DataWeave.
. Run the migrator on a Mule 3 project.
. Import the migrator output into a supported version of Studio 7.
. Review the Migration report.
. Perform a manual migration on what the tool does not migrate.
. Remove uses of Compatibility module components.
. Run any migrated MUnit tests.

These steps are detailed in link:migration-tool-procedure[Migrating to Mule 4].
However, before proceeding with a migration, it is important to review
<<whats_migrated>>.

[[whats_migrated]]
== What is Migrated?

* <<supported_migrations>>
* <<unsupported_migrations>>
* <<unsupported_connectors>>
* <<supported_future>>

[[supported_migrations]]
=== Supported Migrations

//TODO: FOR GA, REMOVE NOTE AND REVISE CONTENT, AS NEEDED
*Note on the Beta release*: This list applies to the Beta and will expand over
time.

The Mule Migration tool supports the following migrations:

* Mule apps only (no domains or policies are supported)
* MEL to DataWeave expressions (simple cases only)
* DataWeave component to `ee:transform` (DataWeave 1.0 to DataWeave 2.0)
* Connectors: HTTP, Database, Web Service Consumer
* Modules: Validations, Scripting (DSL only, no migration of the script itself)
* Transports: HTTP, JMS, File, VM (request-reply not supported)
* Components: Cache, Batch, For Each, Choice, Scatter-Gather, Poll
* Error Handling, Transactional scope
* Properties and secure properties
* Spring Beans definitions
* link:migration-tool:munit[MUnit tests]
* ApiKit

Note that the <<compatibility_module, Compatibility module>> supports some
additional items from Mule 3.x until you can migrate them:

* `set-property`
* `remove-property`
* `copy-properties`
* `set-session-variable`
* `remove-session-variable`

[[unsupported_migrations]]
=== Unsupported Migrations

//TODO: FOR GA, REMOVE NOTE AND REVISE CONTENT, AS NEEDED
*Note on the Beta release*: This list applies to the Beta and will change over
time.

The Mule Migration tool does not support the following migrations:

* Custom Java code, either used directly or through any of the following:
** `<custom-transformer>`
** `<custom-message-processor>`
** `<component`
** `<pooled-component>`
** `<invoke>`
** Anything that implements the `org.mule.api.lifecycle.Callable` interface
** etc.
* DataMapper: Use the DataWeave Migration tool. See
link:migration-tool-procedure[Migrating from the DataMapper to DataWeave].

See also:

* <<unsupported_projects>>
* <<devkit>>
* <<unsupported_connectors>>

[[unsupported_connectors]]
=== Unsupported Connectors

Connectors that are used in an app but not yet supported by the Mule Migration
tool generate this ERROR in the Migration report:

`The migration of some-connector is not supported`

Such connectors require manual migration. To manually migrating them:

. link:connectors/common-add-module-task[Add the equivalent connector] for
Mule 4 to the app.
. Refer to the connector documentation for both Mule 3 and Mule 4 to determine
the correct mappings for the connector:
.. If the connector has a `config` element, add a new configuration that is
equivalent to that of the Mule 3 app.
.. Migrate the sources and inbound endpoints to the source that are provided
by the connector for Mule 4.
.. Migrate the operations and outbound endpoints to the operations provided
by the connector for Mule 4.
.. Migrate any expressions that use the inbound properties that are set by a
source or operation of a connector in Mule 3 to refer to the `attributes`,
instead.

For custom connectors built with DevKit, see link:migration-tool-procedure#devkit[Migrating Custom DevKit Connectors].

[[supported_future]]
=== Supported in the Future

*Note on the Beta Release:* This list might change over time.

For future releases, we will also support these:

* Attachments and multipart handling
* DataWeave 1.0 CSV output
* `<spring:import>` tags
* CorrelationID handling in the JMS transport
* Documentation on how to migrate DataMapper transformations
* Object Stores
* `<until-successful>`
* `<first-successful>`
* `<async>`
* Security Module
* Watermark
* Domains
* Email transport
* Tracking component
* Gzip transformers
* Basic structure for policies
* FTP and SFTP transports
* XML and JSON module
* Splitter and aggregator pattern

== See Also

link:migration-report[Migration Report]

link:migration-tool-post-mig[Migration to Mule 4: Recommended Post-Migration Tasks]
