= About Scatter-Gather
:imagesdir: ./_images

The Scatter-Gather component is a routing event processor. It copies (*scatters*) the previous Mule event in parallel (in separate threads) to two or more routes, where each route is a sequence of one or more event processors (similar to a subflow), then collects (*gathers*) the responses from each route together to create a new Mule event that is passed to the next event processor.

== How Scatter-Gather Processes Mule Events in Parallel
By default, if all the routes are successfull, the resulting Mule event of the Scatter Gather is a new object that lists the individual Mule events from each route. Each listed Mule event in the gathered result object includes the entire Mule event from each route - the payload, attributes, and any variables. 

Scatter-Gather executes each route in parallel (at the same time) instead of sequentially. Parallel execution of routes can greatly increases the efficiency of your Mule application and may provide more information than sequential processing.

Configuring a Scatter-Gather with only one route throws an exception. +
A Mule appliction will thrown an exception and not start if it contains a flow with a Scatter-Gather that has not been configured with at least two routes.

The Scatter-Gather only completes as soon as every route completes successfully. The Scatter-Gather can also configure a timeout. If the timeout expires before all the routes complete, the Scatter-Gather throws an error, which is then handled by whatever error handlers have been configured. 

image::scatter-gather-concept-56ccc.png[]

== How Errors Generated Inside Scatter-Gather Routes are Handled
Each route of a Scatter-Gather can use a Try scope to handle any errors that are generated by its event processors. Any unhandled errors in a route will cause the entire Scatter-Gather to also throw an error of type MULE:COMPOSITE_ERROR. The MULE:COMPOSITE_ERROR is only thrown after every route completes. The MULE:COMPOSITE_ERROR type error object gathers together the Mule events from successfully completed routes plus the errors from any routes that failed. 

Like all errors, once the Scatter-Gather throws an error, processing does not continue past the Scatter-Gather component in the original flow. Event processing braches to the error handling event processors. 

The MULE:COMPOSITE_ERROR contains all the errors that were generated from any of the routes, plus the Mule event from any successfully completed routes. This allows you to still process Mule events from successfully completed routes inside your error handler event processors. 

== How Scatter-Gather Timeout Errors are Handled
A Scatter-Gather timeout is applied to each route. If a route does not complete processing within the configured timeout, the route throws a MULE:TIMEOUT error. This error is then handled the same way as any other error generated from a route - after all the routes complete (either by completing the last event processor or by throwing a MULE:TIMEOUT error), the successful results and errors are collected together and rethrown as a MULE:COMPOSITE error, which can then be processed in an error handler. 

== Downloading and Installing the Scatter-Gather Example from Anypoint Exchange

In Anypoint Studio, you can download and open the example project _Scatter-Gather Flow Control_ from Anypoint Exchange to learn more about how to use the Scatter-Gather component. This example shows the usage of the scatter-gather control flow to aggregate data in parallel and return the result in JSON.

The example uses prepared data as input for two resources that should be aggregated. The data represents information about two contacts and has the following structure:

|===
Resource|`firstname`|`surname`|`phone`|`email`
|contacts-1.csv
|John
|Doe
|096548763
|john.doe@texasComp.com

|contacts-2.csv
|Jane
|Doe
|091558780
|jane.doe@texasComp.com
|===

DataWeave is used to aggregate the data. The information about the contacts is aggregated to a JSON structure that represents data from both resources.

To download and open this example project while you are in Anypoint Studio, click the Exchange icon in the upper-left corner. Then, in the window that opens, log into Anypoint Exchange and search on the name of the project.

== See Also

* link:scatter-gather-xml-reference[Scatter-Gather XML Reference]
* link:about-components[About Mule Components]
