# Configure the Choice in Anypoint Studio's Visual Editor
:imagesdir: ./_images

To configure the choice flow control, you need to determine the following message routing details:

* What content the choice flow router evaluates to determine routing
* Number of routing options for the choice flow control
* Default routing option
* What processing Mule performs for each routing option

To learn how to configure choice flow control, you can use the following procedure, which starts with this flow:

image:choice-router-initial-flow.png[InitialFlow]

To get started with this flow, you can create a new Mule project in Anypoint Studio version 7 or later, replacing the XML in the default XML file in `src/main/mule` with this XML:

.XML source
[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:scripting="http://www.mulesoft.org/schema/mule/scripting" xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd
http://www.mulesoft.org/schema/mule/scripting http://www.mulesoft.org/schema/mule/scripting/current/mule-scripting.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
<http:listener-config name="HTTP_Listener_Configuration" host="localhost" port="8081" doc:name="HTTP Listener Configuration"/>
<flow name="choiceExample" >
        <http:listener doc:name="Listener" doc:id="698b7d0e-1e5e-4105-bd24-6d900eb47f08" config-ref="HTTP_Listener_Configuration" path="/"/>
        <set-variable variableName="language" value="#[message.inboundProperties.'http.query.params'.language]" doc:name="Set Language Variable"/>
		<logger message="#[payload]" level="INFO" doc:name="Logger"/>
</flow>
</mule>
----

Your task is to configure a flow that listens for a GET request that includes the attribute `language`. This attribute can have one of three values: `French`, `Spanish`, or `English`. The value determines the message that the flow returns:

- If the value is `French`, the flow returns `Bonjour!`.
- If the value is `Spanish`, the flow returns `Hola!`.
- If the value is `English` or if the message contains no `language` attribute, the flow returns `Hello!`. This option is the default option.

== Procedure

. Insert a *Choice* component into the flow, placing it after the *Set Variable* component.
+
image:choice-router-add-component.png[AddingToFlow]
+
. Within the scope of the *Choice* component, insert components that represent the different routing options.
.. Drag a *Set Variable* component into the *Default* area, and then place a *Set Payload* component after than.
.. Drag two more *Set Payload* components to positions within the scope of the *Choice* component.

+
image:choice-router-example-flow.png[choice-flow]

. Change the display name of the first *Set Payload* component to reflect the option that it represents, and specify its output message.
.. Select the component.
.. In the properties editor, change the value in *Display Name* to `Reply in French`.
.. Also in the properties editor, change the value in *Value* to `Bonjour!`.

. Change the display name of the second *Set Payload* component to reflect the option that it represents, and specify its output message.
.. Select the component.
.. In the properties editor, change the value in *Display Name* to `Reply in Spanish`.
.. Also in the properties editor, change the value in *Value* to `Hola!`.

. Click the *Choice* component to open its properties editor. You can enter Mule expressions to define the routing logic that Mule applies to incoming messages (see table below; detailed instructions follow).
+
[%header,cols="70a,30a"]
|===
|When |Route Message to
|`#[flowVars.language == 'Spanish']` |`Set Payload`
|`#[flowVars.language == 'French']` |`Set Payload`
|`Default` |`Variable`
|===
+
. In the table, double-click the first empty row under *When*, as indicated by the blue arrow in this image:
+
image:choice-router-reply-in-french-1.png[ChoiceClickHere]
+
. In the *Route Properties* dialog, enter: +
`#[flowVars.language == 'French']`
+
image:choice-router-route-properties-french.png[ChoiceRouteProperties]
+
. Click *OK*. This expression tells Mule to look for a flow variable called `language` on the incoming message and check whether it equals French. If this expression evaluates to true, Mule routes the message to the message processor in that path.
. Click the next empty row, and enter in the *Route Properties* dialog: +
`#[flowVars.language == 'Spanish']`
+
Just as in the previous row, this expression tells Mule to look for a flow variable called `language` in the incoming message. This time, the expression indicates Mule should check whether `language` equals Spanish. If this expression evaluates to true, Mule routes the message to the message processor in that path.
+
. Click *OK*.
. Double-click the *Default* line item to open its *Route Properties* dialog.
+
Notice that:
+
.. You cannot edit the *Expression* field
.. The *Otherwise* box is checked
+
The *Otherwise* box identifies this route as the *Default*  for the choice flow control. If the flow control cannot route a message to any of the preceding routing options in its scope, it directs the message to the default route.
. Click the *Set Payload* processor for *Reply in French* and set the value to `Bonjour!`.
+
If Mule finds the flow variable `language=French`, your message produces this payload as a response.
. Next, click the *Set Payload* processor for *Reply in Spanish* to open its Properties Editor and set value to `Hola!`
+
If Mule finds the flow variable `language=Spanish`, your message produces this payload as a response.
+
. Click the *Set Variable* component inside the *Default* box that is in the message flow to open the component's properties editor. Set *Name* to `language` and *Value* to `English`.
+
image:choice-router-set-default.png[Setting the default language to English]
+
This *Set Variable* component, and the *Set Payload* component that follows it, are only invoked if neither of the expressions in the choice routing logic evaluate to true. Thus, if Mule does not find either the flow variable `language=French` or the flow variable `language=Spanish`, Mule routes the message to this default processing option, which sets the flow variable `language` with the value `English`.
+
[NOTE]
Note that in this configuration you are setting a literal value for the variable, rather than using Mule expression language to extract a value from the message, as you did in the previous *Set Variable* component.


. Click the *Set Payload* component that comes after the *Set Variable* component inside the Default box. Then, in the properties editor, set the value to `Hello!`.
+
This *Set Payload* component sets a payload for the default option you configured above in your choice routing logic.
+
As it processes messages, Mule evaluates the expressions defined in your routing options in order, top down, until one of them evaluates to "true".
+
. If necessary, drag and drop processors within the choice flow control scope on the canvas to reorder routing options.
