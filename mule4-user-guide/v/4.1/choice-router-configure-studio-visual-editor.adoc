# Tutorial: Routing Messages in Anypoint Studio's Visual Editor
:imagesdir: ./_images

You can follow the procedure in this tutorial to learn the basics of routing messages in a flow by using the *Choice* component.

The end result is a flow that listens for requests. The *Choice* component finds out whether each request contains a `language` attribute. The presence and value of this attribute determine how the *Choice* component routes the message:

- If the value is `French`, the component routes the message to a *Set Payload* component that is named *Reply in French*. This latter component returns the message `Bonjour!` to the requester.
- If the value is `Spanish`, the component routes the message to a *Set Payload* component that is named *Reply in Spanish*. This latter component returns the message `Hola!` to the requester.
- If the message contains no `language` attribute, the component routes the message to the default path. The first component in this path, a *Set Variable* component named *Set Language to English*, sets the value of `language` to `English`. The next component in this path, a *Set Payload* component named *Reply in English*, returns the message `Hello!`.

This example demonstrates that, when you are planning to route messages in a flow by using a *Choice* component, there are four aspects to planning that you need to consider:

* The content that the *Choice* component evaluates to determine how it routes messages
* The number of routes
* The default routing option
* The processing that the flow performs for each routing option

== Prerequisite

You start with the following, unfinished flow:

image:choice-router-initial-flow.png[InitialFlow]

To create this inital flow, create a new Mule project in Anypoint Studio version 7 or later, replacing the XML in the default XML file in `src/main/mule` with this XML:

.XML source
[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:scripting="http://www.mulesoft.org/schema/mule/scripting" xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd
http://www.mulesoft.org/schema/mule/scripting http://www.mulesoft.org/schema/mule/scripting/current/mule-scripting.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
<http:listener-config name="HTTP_Listener_Configuration" host="localhost" port="8081" doc:name="HTTP Listener Configuration"/>
<flow name="choiceExample" >
        <http:listener doc:name="Listener" doc:id="698b7d0e-1e5e-4105-bd24-6d900eb47f08" config-ref="HTTP_Listener_Configuration" path="/"/>
        <set-variable variableName="language" value="#[message.inboundProperties.'http.query.params'.language]" doc:name="Set Language Variable"/>
		<logger message="#[payload]" level="INFO" doc:name="Logger"/>
</flow>
</mule>
----

== Procedure

. Drag a *Choice* component into the flow, placing it after the *Set Variable* component.
+
image:choice-router-add-component.png[AddingToFlow]
+
*Result:* The component appears inside a box that has three parts:
+
image:choice-router-three-parts.png[ThreeParts]
+
1. The first part contains the *Choice* component itself.
2. The second part will contain the non-default routing options.
3. The third part will contain the default routing option.

+
. Within the scope of the *Choice* component, insert components that represent the different routing options.
.. Drag a *Set Variable* component into the *Default* area, and then place a *Set Payload* component after than.
.. Drag two more *Set Payload* components to positions within the scope of the *Choice* component.

+
image:choice-router-example-flow.png[choice-flow]

. Change the display name of the first *Set Payload* component to reflect the option that it represents, and specify its output message.
.. Select the component.
.. In the properties editor, change the value in *Display Name* to `Reply in French`.
.. Also in the properties editor, change the value in *Value* to `Bonjour!`.

. Change the display name of the second *Set Payload* component to reflect the option that it represents, and specify its output message.
.. Select the component.
.. In the properties editor, change the value in *Display Name* to `Reply in Spanish`.
.. Also in the properties editor, change the value in *Value* to `Hola!`.

. Change the display names of the components for the default option, set the value of the `language` variable, and specify the output message.
.. In the *Default* area of the *Choice* component, select the *Set Variable* component.
.. In the properties editor, set the display name to `Set Language to English`.
.. Under *Settings*, set the *Name* field to `language` and set the value field to `English`.
.. Select the *Set Payload* component that is in the *Default* area.
.. Set the display name to `Reply in English" and set the *Value* field to `Hello!`.

. Configure the *Choice* component to route messages according to the value of or absence of the attribute `language` in an incoming message.
.. Select the *Choice* component to open its properties editor.
.. In the table, double-click the first empty row under *When*, as indicated by the blue arrow in this image:
+
image:choice-router-reply-in-french-1.png[ChoiceClickHere]
+
.. In the *Route Properties* dialog, type this expression: +
`#[flowVars.language == 'French']`
+
image:choice-router-route-properties-french.png[ChoiceRouteProperties]
+
This expression tells Mule to look for a flow variable called `language` in incoming messages and check whether its value is `French`. If this expression evaluates to true, Mule routes the message to *Reply in French*.
+
.. Click *OK*.
.. Click the next empty row and enter in the *Route Properties* dialog: +
`#[flowVars.language == 'Spanish']`
+
This expression tells Mule to look for the `language` variable and check whether its value is `Spanish`. If this expression evaluates to true, Mule routes the message to *Reply in Spanish*.
+
.. Click *OK*.
.. Double-click the *Default* line item to open its *Route Properties* dialog.
+
Notice that:
+
- You cannot edit the *Expression* field
- The *Otherwise* box is checked
+
The *Otherwise* box identifies this route as the *Default*  for the choice flow control. If the flow control cannot route a message to either of the preceding routing options in its scope, it directs the message to the default route.

. Click the *Set Variable* component inside the *Default* box that is in the message flow to open the component's properties editor. Set *Name* to `language` and *Value* to `English`.
+
image:choice-router-set-default.png[Setting the default language to English]
